<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- è¿™ä¸€è¡Œè®©ç½‘é¡µé€‚é…æ‰‹æœºå±å¹•ï¼Œéå¸¸é‡è¦ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç»„å…±äº«çœ‹æ¿</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <h2>ğŸ“ å°ç»„å®æ—¶ç•™è¨€æ¿</h2>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-box">
            <input type="text" id="msgInput" placeholder="è¾“å…¥å†…å®¹...">
            <button id="sendBtn">å‘é€</button>
        </div>

        <!-- æ¶ˆæ¯åˆ—è¡¨æ˜¾ç¤ºåŒºåŸŸ -->
        <ul id="msgList">
            <li>åŠ è½½ä¸­...</li>
        </ul>
    </div>

    <!-- å¼•å…¥ Firebase SDK -->
    <script type="module">
        // 1. å¼•å…¥å¿…è¦çš„ Firebase åº“ (ä½¿ç”¨ CDN)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 2. ã€è¿™é‡Œç²˜è´´ä½ åˆšæ‰å¤åˆ¶çš„é…ç½®ä»£ç ã€‘
        // ------------------------------------------------
        const firebaseConfig = {
  apiKey: "AIzaSyDTDeExIOqv-gtV_yFmC3JFc4RCHros2Pw",
  authDomain: "team-d3afa.firebaseapp.com",
  projectId: "team-d3afa",
  storageBucket: "team-d3afa.firebasestorage.app",
  messagingSenderId: "232024042720",
  appId: "1:232024042720:web:5f4cab0e4d7d118a597485"
};
        // ------------------------------------------------

        // 3. åˆå§‹åŒ–æ•°æ®åº“
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const msgList = document.getElementById('msgList');
        const sendBtn = document.getElementById('sendBtn');
        const msgInput = document.getElementById('msgInput');

        // 4. ç›‘å¬æ•°æ®åº“å˜åŒ– (è¿™å°±æ˜¯å®ç°å¤šäººåŒæ­¥çš„å…³é”®ï¼)
        // åªè¦æ•°æ®åº“é‡Œæœ‰æ–°æ•°æ®ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè‡ªåŠ¨è¿è¡Œï¼Œæ›´æ–°ç•Œé¢
        const q = query(collection(db, "messages"), orderBy("time", "desc"));
        
        onSnapshot(q, (snapshot) => {
            msgList.innerHTML = ""; // æ¸…ç©ºåˆ—è¡¨
            snapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement('li');
                li.textContent = data.text;
                msgList.appendChild(li);
            });
        });

        // 5. å‘é€æ•°æ®åŠŸèƒ½
        sendBtn.addEventListener('click', async () => {
            const text = msgInput.value;
            if (text.trim() === "") return;

            try {
                await addDoc(collection(db, "messages"), {
                    text: text,
                    time: serverTimestamp() // è®°å½•æœåŠ¡å™¨æ—¶é—´
                });
                msgInput.value = ""; // æ¸…ç©ºè¾“å…¥æ¡†
            } catch (e) {
                alert("å‘é€å¤±è´¥: " + e);
            }
        });
    </script>
</body>

</html>
